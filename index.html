<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우지형 포트폴리오</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: "var(--primary-color)",
                        bgDark: "#100a16",
                        bgCard: "#1e1628",
                        textGray: "#ab9db9"
                    },
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* 네가 만든 스타일 그대로 복구 */
        :root { --primary-color: #8c2bee; }
        body { background-color: #100a16; color: white; }
        .glass-card { background: rgba(30, 22, 40, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); }
        .glass-card:hover { border-color: rgba(140, 43, 238, 0.3); background: rgba(30, 22, 40, 0.8); }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #100a16; }
        ::-webkit-scrollbar-thumb { background: #302839; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #8c2bee; }
        body.is-editing .editable-text-direct { border: 1px dashed #8c2bee; background: rgba(140, 43, 238, 0.1); cursor: text; }
        body.is-editing .editable-trigger { border: 1px solid #8c2bee; position: relative; }
        body.is-editing .editable-img { cursor: pointer; border: 2px dashed #8c2bee !important; opacity: 0.8; }
        body.is-editing a.editable-link { cursor: context-menu !important; border: 1px dotted #8c2bee; }
        #profile-img { aspect-ratio: 1 / 1; object-fit: cover; border-radius: 50%; }
        .add-btn, .delete-btn, .editor-toolbar { display: none; }
        body.is-editing .add-btn { display: flex; }
        body.is-editing .delete-btn { display: block; }
        body.is-editing .editor-toolbar { display: flex; }
        .delete-btn { position: absolute; right: 5px; top: 5px; background: #ef4444; color: white; border-radius: 50%; width: 24px; height: 24px; text-align: center; line-height: 24px; z-index: 10; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .dragging { opacity: 0.5; border: 2px dashed #8c2bee !important; background: rgba(140, 43, 238, 0.05); }
        .bookmark-card:hover { background-color: rgba(255, 255, 255, 0.1); border-color: rgba(140, 43, 238, 0.5); }
        input[type=range].skill-slider { -webkit-appearance: none; background: transparent; width: 100%; }
        input[type=range].skill-slider::-webkit-slider-runnable-track { height: 4px; cursor: pointer; background: rgba(255, 255, 255, 0.1); border-radius: 2px; }
        input[type=range].skill-slider::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--primary-color); cursor: pointer; margin-top: -6px; box-shadow: 0 0 5px var(--primary-color); }
        .skill-row { display: flex; align-items: center; gap: 10px; }
        .skill-icon { width: 24px; text-align: center; font-size: 14px; }
        .skill-name { width: 80px; font-size: 12px; font-weight: bold; }
        .skill-bar-bg { flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; position: relative; }
        .skill-bar-fill { height: 100%; background-color: var(--primary-color); border-radius: 3px; transition: width 0.3s; }
        #loading-screen { position: fixed; inset: 0; background: #100a16; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4 md:p-8 max-w-7xl mx-auto">
    <div id="loading-screen">
        <div class="text-center">
            <span class="material-symbols-outlined text-5xl text-primary animate-spin">sync</span>
            <p class="mt-4 text-gray-400 font-bold">서버 데이터 연결 중...</p>
        </div>
    </div>

    <input type="file" id="imageInput" accept="image/*" style="display: none;">
    <input type="file" id="detailImageInput" accept="image/*" style="display: none;" multiple>
    <input type="file" id="pdfInput" accept="application/pdf" style="display: none;">

    <header class="flex justify-between items-center mb-8 sticky top-0 z-40 py-4 bg-[#100a16]/80 backdrop-blur-md">
        <div class="flex items-center gap-4">
            <input type="color" id="themeColorPicker" class="w-8 h-8 rounded-full overflow-hidden cursor-pointer border-2 border-white/20 p-0 bg-transparent" value="#8c2bee" oninput="changeThemeColor(this.value)">
            <button onclick="resetThemeColor()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors text-white/70 hover:text-white"><span class="material-symbols-outlined text-sm">restart_alt</span></button>
            <button onclick="toggleEditMode()" class="flex items-center gap-2 bg-primary/20 text-primary px-4 py-2 rounded-lg hover:bg-primary/40 transition-all font-bold">
                <span class="material-symbols-outlined">edit_square</span>
                <span id="editBtnText">편집 모드</span>
            </button>
        </div>
        <a href="mailto:wjh@example.com" id="contactBtn" class="editable-link bg-white text-black px-6 py-2 rounded-full font-bold hover:bg-gray-200 transition-colors flex items-center gap-2">
            <span>Contact Me</span><span class="material-symbols-outlined text-sm">send</span>
        </a>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="glass-card rounded-3xl p-8 md:row-span-2 md:col-span-1 flex flex-col items-center text-center relative overflow-hidden group">
            <img id="profile-img" src="WOO.jpg" alt="Profile" class="w-48 h-48 mb-6 border-4 border-primary/30 shadow-2xl editable-img">
            <h1 id="profile-name" class="text-3xl font-black mb-2 editable-text-direct">우지형</h1>
            <p id="profile-role" class="text-primary font-bold mb-6 editable-text-direct">Growth Marketer</p>
            <div id="profile-desc" class="text-textGray leading-relaxed mb-auto text-lg editable-text-direct">인문학적 통찰과 책임있는 실행력을 가진 미래의 기자 지망생입니다.</div>
            <div class="flex gap-4 mt-6">
                <a href="#" id="sns-insta" target="_blank" class="editable-link w-16 h-16 flex items-center justify-center bg-white/5 rounded-full hover:scale-110"><i class="fab fa-instagram text-3xl"></i></a>
                <a href="#" id="sns-gmail" class="editable-link w-16 h-16 flex items-center justify-center bg-white/5 rounded-full hover:scale-110"><i class="far fa-envelope text-3xl"></i></a>
            </div>
        </div>

        <div class="glass-card rounded-3xl p-6 md:col-span-1 flex flex-col justify-between relative overflow-hidden min-h-[160px]">
            <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse shadow-[0_0_10px_#22c55e]"></span>
            <h3 id="status-text" class="text-2xl font-bold editable-text-direct leading-tight">SKCE 23기 지원</h3>
        </div>

        <div class="glass-card rounded-3xl p-6 md:row-span-2 md:col-span-1 flex flex-col relative overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold flex items-center gap-2"><span class="material-symbols-outlined text-primary">history_edu</span> Experience</h2>
                <button onclick="addNewItem('exp')" class="add-btn bg-purple-500/20 text-primary px-2 py-1 rounded text-xs">추가</button>
            </div>
            <div class="overflow-y-auto pr-2 space-y-6 flex-1 custom-scrollbar" id="timeline-container"></div>
        </div>

        <div class="glass-card rounded-3xl p-6 md:row-span-2 md:col-span-1 flex flex-col overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold flex items-center gap-2"><span class="material-symbols-outlined text-primary">rocket_launch</span> Recent Work</h2>
                <button onclick="addNewItem('proj')" class="add-btn bg-purple-500/20 text-primary px-2 py-1 rounded text-xs">추가</button>
            </div>
            <div id="project-container" class="overflow-y-auto pr-2 space-y-4 flex-1 custom-scrollbar"></div>
        </div>

        <div class="md:col-span-1 flex flex-col gap-4">
            <div id="item-skill-perf" class="glass-card rounded-3xl p-6 flex flex-col justify-center relative">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><span class="material-symbols-outlined text-blue-400">analytics</span> Performance</h3>
                <div id="skill-data" style="display:none;">95,75,60,80,95</div>
                <div id="skill-container" class="space-y-1"></div>
            </div>
            <div id="item-skill-copy" class="glass-card rounded-3xl p-6 flex flex-col relative">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg flex items-center gap-2"><span class="material-symbols-outlined text-pink-400">emoji_events</span> Awards</h3>
                    <button onclick="addAward()" class="add-btn bg-pink-500/20 text-pink-400 px-2 py-1 rounded text-xs">추가</button>
                </div>
                <div id="awards-container" class="space-y-3 overflow-y-auto custom-scrollbar max-h-[200px] pr-1"></div>
            </div>
        </div>
    </main>

    <div class="glass-card rounded-3xl overflow-hidden relative group cursor-pointer min-h-[200px] mt-6 h-64" onclick="editMap()">
        <iframe id="map-frame" src="https://www.google.com/search?q=https://www.google.com/maps/embed%3Fpb%3D!1m18!1m12!1m3!1d3165.352646679544!2d126.9554!3d37.4963!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x357ca1d5c2e97669%253A0xc3b86027735397f3!2z7Iit7Iuk64yA7ZWZ6rWQ!5e0!3m2!1sko!2skr!4v1234567890" class="w-full h-full border-0 filter grayscale invert contrast-125 opacity-70"></iframe>
    </div>

    <footer class="mt-6 text-center text-textGray text-xs"><p>© 2025 Woo Jee-hyung. All rights reserved.</p></footer>

    <div id="detail-overlay" class="fixed inset-0 bg-bgDark z-50 hidden overflow-y-auto animate-[fadeIn_0.3s_ease-out]">
        <button onclick="closeDetail()" class="fixed top-6 right-6 z-[60] bg-black/50 p-2 rounded-full hover:bg-primary text-white transition-colors"><span class="material-symbols-outlined text-3xl">close</span></button>
        <div class="max-w-4xl mx-auto mt-32 relative px-4 pb-20">
            <div class="glass-card bg-[#1e1628] p-8 md:p-12 rounded-3xl shadow-2xl border border-white/10">
                <div class="flex gap-4 mb-6 text-xl font-bold text-primary"><span id="detail-date" class="editable-detail">DATE</span><span>|</span><span id="detail-company" class="editable-detail">COMPANY</span></div>
                <h1 id="detail-title" class="text-4xl md:text-5xl font-black mb-6 leading-tight editable-detail">제목</h1>
                <div id="detail-toolbar" class="editor-toolbar gap-2 mb-4">
                    <button onclick="insertBookmark()" class="bg-white/10 px-3 py-1 rounded text-sm hover:bg-white/20 transition-colors">북마크 삽입</button>
                </div>
                <div id="detail-desc" class="text-lg text-gray-300 leading-relaxed editable-detail whitespace-pre-line min-h-[100px]"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBE0teXJrc6TzhiCdw-PVQnB--qSsDGjFg",
            authDomain: "woo-portfolio-4f289.firebaseapp.com",
            projectId: "woo-portfolio-4f289",
            storageBucket: "woo-portfolio-4f289.firebasestorage.app",
            messagingSenderId: "684980980660",
            appId: "1:684980980660:web:538774434c11340001c0e1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 지형이의 기존 전역 변수들
        window.isEditing = false;
        window.currentActiveKey = null;
        const skillConfig = [
            { name: 'PPT', icon: 'fa-file-powerpoint', color: 'text-orange-500' },
            { name: 'Photoshop', icon: 'fa-palette', color: 'text-blue-500' },
            { name: 'Premiere Pro', icon: 'fa-film', color: 'text-purple-500' },
            { name: 'Excel', icon: 'fa-file-excel', color: 'text-green-500' },
            { name: 'Word', icon: 'fa-file-word', color: 'text-blue-600' }
        ];

        // [데이터 로드] 서버에서 HTML 구조를 가져와 덮어씌움
        async function loadFromServer() {
            try {
                const docRef = doc(db, "portfolio", "main");
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data().html;
                    const parser = new DOMParser();
                    const newDoc = parser.parseFromString(data, 'text/html');
                    
                    // 핵심 구역만 갈아끼우기 (지형이의 레이아웃 유지)
                    const targetIds = ['timeline-container', 'project-container', 'awards-container', 'profile-name', 'profile-role', 'profile-desc', 'status-text', 'profile-img', 'map-frame', 'skill-data', 'sns-insta', 'sns-gmail', 'contactBtn'];
                    targetIds.forEach(id => {
                        const newEl = newDoc.getElementById(id);
                        const oldEl = document.getElementById(id);
                        if (newEl && oldEl) {
                            if (id === 'profile-img') oldEl.src = newEl.src;
                            else if (id === 'map-frame') oldEl.src = newEl.src;
                            else if (['sns-insta', 'sns-gmail', 'contactBtn'].includes(id)) oldEl.href = newEl.href;
                            else oldEl.innerHTML = newEl.innerHTML;
                        }
                    });
                }
            } catch (e) { console.error("로드 실패:", e); }
            finally { 
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-screen').remove(), 500);
                renderSkills(); 
            }
        }

        // [서버 저장] 
        window.saveToFirebase = async function() {
            const currentHTML = document.documentElement.outerHTML;
            try {
                await setDoc(doc(db, "portfolio", "main"), { html: currentHTML });
                alert("✅ 구글 서버에 영구 저장되었습니다!");
            } catch (e) { alert("저장 실패!"); }
        }

        // 지형이의 기존 기능들 100% 복구
        window.toggleEditMode = async function() {
            window.isEditing = !window.isEditing;
            const body = document.body;
            if (window.isEditing) {
                body.classList.add('is-editing');
                document.getElementById('editBtnText').innerText = "저장 하기";
                document.querySelectorAll('.editable-text-direct').forEach(el => el.contentEditable = "true");
                renderSkills();
            } else {
                body.classList.remove('is-editing');
                document.getElementById('editBtnText').innerText = "편집 모드";
                document.querySelectorAll('[contentEditable]').forEach(el => el.contentEditable = "false");
                renderSkills();
                await saveToFirebase();
            }
        }

        window.renderSkills = function() {
            const container = document.getElementById('skill-container');
            const dataEl = document.getElementById('skill-data');
            const values = dataEl.innerText.split(',').map(Number);
            container.innerHTML = skillConfig.map((skill, i) => `
                <div class="skill-row">
                    <div class="skill-icon"><i class="fas ${skill.icon} ${skill.color}"></i></div>
                    <div class="skill-name">${skill.name}</div>
                    <div class="flex-1 relative">
                        <div class="skill-bar-bg"><div class="skill-bar-fill ${skill.color.replace('text-','bg-')}" style="width: ${values[i]}%"></div></div>
                        ${window.isEditing ? `<input type="range" min="0" max="100" value="${values[i]}" class="skill-slider absolute top-[-5px] left-0" oninput="updateSkillValue(${i}, this.value)">` : ''}
                    </div>
                    <div class="text-xs font-bold w-8 text-right">${values[i]}%</div>
                </div>
            `).join('');
        }

        window.updateSkillValue = function(i, val) {
            const dataEl = document.getElementById('skill-data');
            const vals = dataEl.innerText.split(',');
            vals[i] = val;
            dataEl.innerText = vals.join(',');
            renderSkills();
        }

        window.addNewItem = function(type) {
            const id = type + Date.now();
            const container = type === 'exp' ? document.getElementById('timeline-container') : document.getElementById('project-container');
            const html = type === 'exp' ? `
                <div id="item-${id}" class="editable-trigger-wrapper relative pl-6 border-l-2 border-primary/30 hover:border-primary transition-colors cursor-pointer group" onclick="openDetail('${id}')">
                    <button class="delete-btn material-symbols-outlined" onclick="deleteItem(event, 'item-${id}')">close</button>
                    <span class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-bgDark border-2 border-primary"></span>
                    <span class="text-xs text-primary font-bold mb-1 block" data-key="${id}-date">DATE</span>
                    <h3 class="text-lg font-bold mb-1" data-key="${id}-title">New Exp</h3>
                    <p class="text-sm text-textGray" data-key="${id}-company">Company</p>
                    <div data-key="${id}-full-desc" style="display:none;"></div>
                </div>` : `
                <div id="item-${id}" class="editable-trigger-wrapper bg-bgDark/50 p-4 rounded-xl border border-white/5 hover:border-primary/50 transition-all cursor-pointer group" onclick="openDetail('${id}')">
                    <button class="delete-btn material-symbols-outlined" onclick="deleteItem(event, 'item-${id}')">close</button>
                    <h3 class="font-bold text-white mb-1" data-key="${id}-title">New Work</h3>
                    <p class="text-xs text-textGray" data-key="${id}-desc">Description</p>
                    <div data-key="${id}-full-desc" style="display:none;"></div>
                </div>`;
            container.insertAdjacentHTML('afterbegin', html);
        }

        window.deleteItem = function(e, id) {
            e.stopPropagation();
            if(confirm("삭제할까?")) document.getElementById(id).remove();
        }

        window.openDetail = function(key) {
            window.currentActiveKey = key;
            const item = document.getElementById('item-' + key) || document.getElementById('item-' + key);
            const title = document.querySelector(`[data-key="${key}-title"]`)?.innerText || "";
            const date = document.querySelector(`[data-key="${key}-date"]`)?.innerText || "";
            const company = document.querySelector(`[data-key="${key}-company"]`)?.innerText || "";
            const fullDesc = document.querySelector(`[data-key="${key}-full-desc"]`)?.innerHTML || "";

            document.getElementById('detail-title').innerText = title;
            document.getElementById('detail-date').innerText = date;
            document.getElementById('detail-company').innerText = company;
            document.getElementById('detail-desc').innerHTML = fullDesc;

            if(window.isEditing) document.querySelectorAll('.editable-detail').forEach(el => el.contentEditable = "true");
            document.getElementById('detail-overlay').classList.remove('hidden');
        }

        window.closeDetail = function() {
            if(window.isEditing && window.currentActiveKey) {
                const key = window.currentActiveKey;
                document.querySelector(`[data-key="${key}-title"]`).innerText = document.getElementById('detail-title').innerText;
                document.querySelector(`[data-key="${key}-full-desc"]`).innerHTML = document.getElementById('detail-desc').innerHTML;
            }
            document.getElementById('detail-overlay').classList.add('hidden');
        }

        window.insertBookmark = async function() {
            const url = prompt("북마크할 URL 입력:");
            if(!url) return;
            
            // 썸네일 가져오기 (외부 서비스 사용) 및 컴팩트한 디자인 적용
            const thumbUrl = `https://image.thum.io/get/width/150/crop/800/noanimate/${url}`;
            
            const html = `<a href="${url}" target="_blank" class="bookmark-card flex items-center gap-3 bg-white/5 p-2 rounded-lg no-underline my-2 border border-white/10 h-16 overflow-hidden hover:bg-white/10 transition-colors">
                <img src="${thumbUrl}" alt="thumbnail" class="w-16 h-full object-cover rounded-md flex-shrink-0 bg-black/20">
                <div class="flex flex-col justify-center min-w-0">
                    <div class="font-bold text-white text-sm truncate">${url}</div>
                    <div class="text-xs text-gray-400 truncate">페이지 방문하기</div>
                </div>
            </a>`;
            document.getElementById('detail-desc').innerHTML += html;
        }

        // 링크 수정 이벤트 (편집 모드일 때만 동작)
        document.addEventListener('click', function(e) {
            if (window.isEditing) {
                const link = e.target.closest('.editable-link');
                if (link) {
                    e.preventDefault();
                    const newUrl = prompt("변경할 링크 주소를 입력하세요:", link.getAttribute('href'));
                    if (newUrl !== null) link.setAttribute('href', newUrl);
                }
            }
        });

        // 프로필 이미지 클릭 시 파일 업로드 (편집 모드)
        document.getElementById('profile-img').addEventListener('click', function() {
            if (window.isEditing) document.getElementById('imageInput').click();
        });

        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profile-img').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        loadFromServer();
    </script>
</body>
</html>
